name: Sync data from Vault & Burn

on:
  schedule:
    - cron: "*/30 * * * *"   # ogni 30 minuti (puoi cambiare)
  workflow_dispatch:         # avvio manuale dal tab "Actions"

permissions:
  contents: write            # serve per fare commit/push

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout hub repo
        uses: actions/checkout@v4

      - name: Create data folder if missing
        run: mkdir -p data

      - name: Download JSON from other repos
        run: |
          # status.json da Nummus.VaultDAO
          curl -sS \
            https://raw.githubusercontent.com/Happydao/Nummus.VaultDAO/main/data/status.json \
            -o data/status.json

          # burn.json da Nummus.burn
          curl -sS \
            https://raw.githubusercontent.com/Happydao/Nummus.burn/main/data/burn.json \
            -o data/burn.json

          # price.json da Nummus.burn
          curl -sS \
            https://raw.githubusercontent.com/Happydao/Nummus.burn/main/data/price.json \
            -o data/price.json

      - name: Commit & push if changed
        run: |
          if [[ -n "$(git status --porcelain data/)" ]]; then
            git config user.name  "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add data/
            git commit -m "Sync data from Vault & Burn [skip ci]"
            git push
          else
            echo "No changes in data/ â€” nothing to commit."
          fi
